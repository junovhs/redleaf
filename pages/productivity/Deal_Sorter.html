<!DOCTYPE html>
<html>
<head>
  <base href="https://example.com/">
  <meta charset="UTF-8">
  <title>Email Deal Sorter</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f0f2f5;
      color: #333;
      line-height: 1.6;
    }

    h1 {
      text-align: center;
      color: #2c3e50;
      margin-top: 30px;
      margin-bottom: 20px;
      font-size: 2.5em;
    }

    #input-section, #output-section {
      max-width: 800px;
      margin: 0 auto 30px auto;
      background: #fff;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: box-shadow 0.3s ease;
    }

    #input-section:hover, #output-section:hover {
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }

    h2, h3 {
      color: #34495e;
      margin-bottom: 15px;
    }

    textarea {
      width: 100%;
      height: 300px;
      padding: 15px;
      font-size: 16px;
      border: 2px solid #bdc3c7;
      border-radius: 8px;
      resize: vertical;
      transition: border-color 0.3s ease;
    }

    textarea:focus {
      border-color: #3498db;
      outline: none;
    }

    .potm-section {
      margin-top: 25px;
      padding: 20px;
      background-color: #ecf0f1;
      border-radius: 8px;
    }

    .potm-input {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
    }

    .potm-input div {
      flex: 1;
      min-width: 220px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #2c3e50;
      font-weight: 500;
    }

    select {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: 2px solid #bdc3c7;
      border-radius: 6px;
      background-color: #fff;
      transition: border-color 0.3s ease;
    }

    select:focus {
      border-color: #3498db;
      outline: none;
    }

    .button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 12px 25px;
      margin-top: 20px;
      font-size: 18px;
      cursor: pointer;
      background-color: #3498db;
      color: #fff;
      border: none;
      border-radius: 6px;
      transition: background-color 0.3s ease, transform 0.2s ease;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .button:hover {
      background-color: #2980b9;
      transform: translateY(-2px);
    }

    .button:active {
      transform: translateY(0);
    }

    .deal-group {
      margin-bottom: 40px;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
    }

    .deal-group h2 {
      margin-bottom: 15px;
      color: #2980b9;
    }

    .deal {
      background: #f9f9f9;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 6px;
      position: relative;
    }

    .deal-overline {
      position: absolute;
      top: -10px;
      left: 15px;
      background: #f9f9f9;
      padding: 3px 8px;
      font-weight: bold;
      color: #2980b9;
      border-radius: 4px;
      font-size: 0.9em;
    }

    .deal-content {
      margin-top: 10px;
    }

    .deal h3 {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 0 0 10px 0;
      font-size: 1.2em;
    }

    .deal p {
      margin: 0;
      font-size: 1em;
      color: #555;
    }

    .copy-button {
      background: none;
      border: none;
      cursor: pointer;
      padding: 5px;
      border-radius: 4px;
      transition: background-color 0.3s ease;
    }

    .copy-button:hover {
      background-color: #ecf0f1;
    }

    .copy-button svg {
      width: 20px;
      height: 20px;
      fill: #3498db;
      transition: fill 0.3s ease;
    }

    .copy-button:hover svg {
      fill: #2980b9;
    }

    @media (max-width: 600px) {
      .potm-input {
        flex-direction: column;
      }
      .deal h3 {
        flex-direction: column;
        align-items: flex-start;
      }
      .copy-button {
        margin-top: 10px;
      }
    }

    .tooltip {
      position: relative;
      display: inline-block;
    }

    .tooltip .tooltiptext {
      visibility: hidden;
      width: 100px;
      background-color: #333;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 5px 0;
      position: absolute;
      z-index: 1;
      bottom: 125%; 
      left: 50%;
      margin-left: -50px;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }
  </style>
</head>
<body>
  <h1>Email Deal Sorter</h1>

  <div id="input-section">
    <h2>Paste Your Deals Here</h2>
    <textarea id="deals-input" placeholder="Paste your list of deals here..."></textarea>
    
    <div class="potm-section">
      <h3>Partners of the Month</h3>
      <div class="potm-input">
        <div>
          <label for="potm1-name">Partner of the Month 1:</label>
          <select id="potm1-name">
            <option value="">Select Partner 1</option>
          </select>
        </div>
        <div>
          <label for="potm2-name">Partner of the Month 2:</label>
          <select id="potm2-name">
            <option value="">Select Partner 2</option>
          </select>
        </div>
      </div>
    </div>

    <button class="button" onclick="processDeals()">Sort Deals</button>
  </div>

  <div id="output-section" style="display:none;">
    <h2>Selected Supplier Deals</h2>
    <div id="sorted-deals"></div>
  </div>

  <script>
    // List of suppliers (for dropdowns and ordering)
    const suppliersOrder = [
      "Norwegian", "Royal Caribbean", "Celebrity", "Disney Cruise Line",
      "Virgin Voyages", "Holland America Line", "Princess", "Carnival",
      "MSC Cruises", "Costa Cruises", "Viking Ocean", "Seabourn",
      "Regent Seven Seas Cruises", "Oceania Cruises", "Silversea",
      "Explora Journeys", "Azamara", "Scenic Eclipse Ocean Voyages",
      "Atlas Ocean Voyages", "Crystal Cruises", "Emerald Cruises",
      "Cunard", "Windstar", "Paul Gauguin Cruises", "Ponant",
      "American Cruise Line", "Tauck Cruises", "Star Clippers",
      "Four Seasons Yachts", "Ritz-Carlton Yacht Collection",
      // Additional suppliers (example for river, adventure, resorts, etc.)
      "Viking River", "Avalon Waterways", "Ama Waterways",
      "CroisiEurope", "Riverside Cruises", "Scenic River",
      "Tauck Tours", "Riviera River Cruises", "Uniworld",
      "Lindblad Expeditions & National Geographic",
      "Hurtigruten", "UnCruise Adventures",
      "DisneyWorld", "Disneyland", "Aulani, A Disney Resort & Spa",
      "Adventures by Disney", "Sandals", "Beaches", "Breathless",
      "Club Med", "El Dorado Spa Resorts & Hotels", "Excellence Resorts",
      "Hard Rock Hotels", "Iberostar Hotels & Resorts", "Dreams",
      "Karisma Hotels & Resorts", "Villas of Distinction", "Palace Resorts",
      "Atlantis Paradise Island Bahamas", "Melia", "RIU Hotels & Resorts",
      "Outrigger Hotels & Resorts", "ZoÃ«try Wellness & Spa Resorts",
      "Secrets", "American Airline Vacations", "Delta Vacations",
      "Southwest Vacations", "United Vacations"
    ];

    // Populate the two Partner of the Month dropdowns
    function populatePOTMDropdowns() {
      const potmSelectors = ["potm1-name", "potm2-name"];
      potmSelectors.forEach(selectorId => {
        const select = document.getElementById(selectorId);
        suppliersOrder.forEach(supplier => {
          const option = document.createElement('option');
          option.value = supplier;
          option.textContent = supplier;
          select.appendChild(option);
        });
      });
    }
    window.onload = populatePOTMDropdowns;

    // Parse deals from the textarea.
    // A deal begins with a line that exactly matches a supplier (case-insensitive).
    // The next nonempty line is the title (if it includes "EXCLUSIVE", we mark it exclusive),
    // followed by a description.
    function parseDeals(rawInput) {
      const lines = rawInput.split('\n');
      const deals = [];
      let currentDeal = null;

      lines.forEach(line => {
        line = line.trim();
        if (!line) return;
        if (line.toLowerCase().includes("logo") || line.toLowerCase().includes("expires soon")) return;

        // Check if line is a supplier name.
        const matchedSupplier = suppliersOrder.find(supplier => supplier.toLowerCase() === line.toLowerCase());
        if (matchedSupplier) {
          currentDeal = { supplier: matchedSupplier, exclusives: false, title: "", description: "" };
          deals.push(currentDeal);
        } else if (currentDeal) {
          if (!currentDeal.title) {
            currentDeal.title = line;
            if (line.toUpperCase().includes("EXCLUSIVE")) {
              currentDeal.exclusives = true;
            }
          } else if (!currentDeal.description) {
            currentDeal.description = line;
          }
        }
      });
      return deals;
    }

    // Group deals by supplier.
    function groupDealsBySupplier(deals) {
      const groups = {};
      deals.forEach(deal => {
        if (!deal.supplier || !deal.title) return;
        if (!groups[deal.supplier]) groups[deal.supplier] = [];
        groups[deal.supplier].push(deal);
      });
      return groups;
    }

    // For each supplier group, choose up to 3 deals.
    // We sort each supplier's deals so that exclusive deals come first.
    function selectDealsForSupplier(deals) {
      const sortedDeals = deals.slice().sort((a, b) => {
        // Exclusives first.
        if (a.exclusives !== b.exclusives) {
          return b.exclusives - a.exclusives;
        }
        return 0;
      });
      // Return up to 3 deals.
      return sortedDeals.slice(0, 3);
    }

    // Select 4 suppliers according to these rules:
    // - A supplier must have at least two deals.
    // - If a supplier has only 2 deals, both must be exclusive.
    // - If a supplier has 3 or more deals, at least one must be exclusive.
    // Then we rank suppliers giving priority to those with 3 deals (over 2) and more exclusive deals.
    function selectSuppliersWithDeals(groups) {
      const supplierCandidates = [];

      Object.keys(groups).forEach(supplier => {
        const deals = groups[supplier];
        const totalDeals = deals.length;
        const exclusiveCount = deals.filter(d => d.exclusives).length;
        let qualifies = false;
        if (totalDeals >= 3 && exclusiveCount >= 1) {
          qualifies = true;
        } else if (totalDeals === 2 && exclusiveCount === 2) {
          qualifies = true;
        }
        if (qualifies) {
          // For display, we take up to 3 deals per supplier.
          const selectedDeals = selectDealsForSupplier(deals);
          // Determine a simple ranking score:
          //   Prefer suppliers with 3 deals over those with 2,
          //   then those with a higher count of exclusive deals,
          //   then by the order in suppliersOrder.
          const countScore = (selectedDeals.length === 3) ? 100 : 0;
          const exclusiveScore = exclusiveCount * 10;
          const supplierIndex = suppliersOrder.indexOf(supplier);
          const orderScore = (supplierIndex !== -1) ? (100 - supplierIndex) : 0;
          const totalScore = countScore + exclusiveScore + orderScore;

          supplierCandidates.push({ supplier, selectedDeals, totalScore });
        }
      });

      // Sort descending by totalScore.
      supplierCandidates.sort((a, b) => b.totalScore - a.totalScore);

      // Return the top 4 suppliers.
      return supplierCandidates.slice(0, 4);
    }

    // Render the selected suppliers and their deals.
    function renderSelectedSuppliers(selectedSuppliers) {
      const sortedDealsDiv = document.getElementById('sorted-deals');
      sortedDealsDiv.innerHTML = "";

      selectedSuppliers.forEach(candidate => {
        const groupDiv = document.createElement('div');
        groupDiv.className = 'deal-group';

        const heading = document.createElement('h2');
        heading.textContent = candidate.supplier;
        groupDiv.appendChild(heading);

        candidate.selectedDeals.forEach(deal => {
          const dealDiv = document.createElement('div');
          dealDiv.className = 'deal';

          const overline = document.createElement('div');
          overline.className = 'deal-overline';
          overline.textContent = deal.exclusives ? "EXCLUSIVE" : "";
          dealDiv.appendChild(overline);

          const contentDiv = document.createElement('div');
          contentDiv.className = 'deal-content';

          const titleEl = document.createElement('h3');
          titleEl.textContent = deal.title;
          // Add copy button for title.
          const copyTitleButton = document.createElement('button');
          copyTitleButton.className = 'copy-button tooltip';
          copyTitleButton.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path d="M16 1H4c-1.1 0-2 .9-2 2v12h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
            </svg>
            <span class="tooltiptext">Copy Title</span>
          `;
          copyTitleButton.onclick = () => copyToClipboard(deal.title);
          titleEl.appendChild(copyTitleButton);
          contentDiv.appendChild(titleEl);

          const descEl = document.createElement('p');
          descEl.textContent = deal.description;
          // Add copy button for description.
          const copyDescButton = document.createElement('button');
          copyDescButton.className = 'copy-button tooltip';
          copyDescButton.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path d="M16 1H4c-1.1 0-2 .9-2 2v12h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
            </svg>
            <span class="tooltiptext">Copy Details</span>
          `;
          copyDescButton.onclick = () => copyToClipboard(deal.description);
          descEl.appendChild(copyDescButton);
          contentDiv.appendChild(descEl);

          dealDiv.appendChild(contentDiv);
          groupDiv.appendChild(dealDiv);
        });

        sortedDealsDiv.appendChild(groupDiv);
      });
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        alert("Copied to clipboard!");
      }).catch(err => {
        console.error('Could not copy text: ', err);
      });
    }

    // Main processing function.
    function processDeals() {
      const rawInput = document.getElementById('deals-input').value;
      const deals = parseDeals(rawInput);
      if (deals.length === 0) {
        alert("No valid deals found. Please check your input.");
        return;
      }
      const groups = groupDealsBySupplier(deals);
      const selectedSuppliers = selectSuppliersWithDeals(groups);
      if (selectedSuppliers.length < 4) {
        alert("Warning: Only " + selectedSuppliers.length + " supplier(s) qualify based on the rules.");
      }
      renderSelectedSuppliers(selectedSuppliers);
      document.getElementById('output-section').style.display = 'block';
    }
  </script>
</body>
</html>
