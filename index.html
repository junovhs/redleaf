<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Base URL for relative links -->
    <base href="https://junovhs.github.io/redleaf/" />

    <!-- Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Page Title -->
    <title>Redleaf</title>

    <!-- Link to Google Fonts for 'Press Start 2P' -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

    <!-- Inline CSS Styles -->
    <style>
        /* Global Styles */
        body {
            background-color: #041317;
            font-family: 'Press Start 2P', 'Courier New', monospace;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #CDCCBB;
        }

        /* Container for content with max width */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            width: 100%;
            box-sizing: border-box;
        }

        /* Navbar Styles */
        .navbar {
            background-color: #041317;
            border: 4px solid #CDCCBB;
            padding: 8px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            min-height: 70px;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            image-rendering: pixelated;
            position: relative;
        }

        /* Inner Navbar for handling responsive behavior */
        .navbar-inner {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: flex-start;
            width: 100%;
            background-color: #041317;
            transition: max-height 0.3s ease-in-out;
            position: relative;
            z-index: 500;
        }

        /* Navigation Items Container */
        .nav-items {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: flex-start;
            margin: 0;
            background: #041317;
            flex: 1;
            max-height: none;
            transition: max-height 0.3s ease-in-out;
            justify-content: flex-start;
        }

        /* Individual Navigation Item */
        .nav-item {
            color: #CDCCBB;
            text-decoration: none;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: normal;
            position: relative;
            height: auto;
            display: flex;
            align-items: center;
            background: #041317;
            border: 4px solid #CDCCBB;
            cursor: pointer;
            transition: all 0.1s;
            white-space: nowrap;
            z-index: 1;
            flex: 1 1 calc(33.333% - 16px);
            box-sizing: border-box;
            justify-content: center;
        }

        /* Hover Effect for Navigation Item */
        .nav-item:hover {
            background: #B04438;
            transform: scale(1.05);
        }

        /* Active State for Navigation Item */
        .nav-item:active {
            transform: scale(0.95);
            background: #B04438;
        }

        /* Styles for Navigation Items with Dropdowns */
        .nav-item.has-dropdown {
            position: relative;
        }

        /* Dropdown Content Container */
        .dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: #041317;
            border: 4px solid #CDCCBB;
            z-index: 1000;
            min-width: 200px;
            padding: 4px;
            max-height: 400px;
            overflow-y: auto;
            flex-direction: column;
        }

        /* Show Dropdown on Hover */
        .nav-item.has-dropdown:hover .dropdown-content,
        .nav-item.has-dropdown.open .dropdown-content {
            display: block;
        }

        /* Individual Dropdown Item */
        .dropdown-item {
            color: #CDCCBB;
            padding: 8px 16px;
            text-decoration: none;
            display: block;
            background: #041317;
            border: none;
            margin: 4px 0;
            cursor: pointer;
        }

        /* Hover Effect for Dropdown Item */
        .dropdown-item:hover {
            background: #B04438;
        }

        /* Main Content Area */
        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #041317;
            padding: 20px;
            border: 4px solid #CDCCBB;
            margin: 10px;
        }

        /* Content Container */
        #content-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #041317;
            border: 4px solid #CDCCBB;
            padding: 4px;
        }

        /* Iframe for Loading External Content */
        #content-frame {
            flex: 1;
            width: 100%;
            border: none;
            min-height: 500px;
            background: #041317;
            display: none; /* Initially hidden */
        }

        /* Home Content Styling */
        #home-content {
            padding: 20px;
            color: #CDCCBB;
            font-family: 'Press Start 2P', monospace;
        }

        /* Footer Styling */
        footer {
            background: #041317;
            color: #CDCCBB;
            text-align: center;
            padding: 1rem;
            border-top: 4px solid #CDCCBB;
        }

        /* Loading Indicator */
        #loading {
            text-align: center;
            padding: 1rem;
            color: #CDCCBB;
            display: none; /* Initially hidden */
        }

        /* Title Bar Styling */
        .title-bar {
            background: #B04438;
            color: #CDCCBB;
            padding: 8px;
            font-weight: bold;
            font-size: 16px;
            text-align: center;
            margin-bottom: 8px;
            border: 4px solid #CDCCBB;
            text-transform: uppercase;
        }

        /* Custom Scrollbar Styles for Dropdown */
        .dropdown-content {
            scrollbar-width: thin;
            scrollbar-color: #B04438 #041317;
        }

        /* Webkit Scrollbar Styles */
        .dropdown-content::-webkit-scrollbar {
            width: 8px;
        }

        .dropdown-content::-webkit-scrollbar-track {
            background: #041317;
        }

        .dropdown-content::-webkit-scrollbar-thumb {
            background-color: #B04438;
            border: 2px solid #041317;
            border-radius: 4px;
        }

        /* Navbar Toggle Button (Hamburger Menu) */
        .navbar-toggle {
            display: none; /* Hidden by default, shown on small screens */
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
        }

        .navbar-toggle svg {
            fill: #CDCCBB;
            width: 24px;
            height: 24px;
        }

        /* Responsive Styles for Screens <= 768px */
        @media (max-width: 768px) {
            /* Adjust Navbar Padding */
            .navbar {
                padding: 4px;
            }

            /* Adjust Navigation Item Styles */
            .nav-item {
                font-size: 12px;
                padding: 6px 12px;
                flex: 1 1 45%;
            }

            /* Logo Height Adjustment (if applicable) */
            .logo {
                height: 25px;
            }

            /* Dropdown Content Adjustments */
            .dropdown-content {
                min-width: 150px;
                position: relative;
                top: auto;
                left: auto;
                z-index: 1001;
            }

            /* Show Navbar Toggle Button */
            .navbar-toggle {
                display: block;
            }

            /* Navbar Inner for Collapsible Menu */
            .navbar-inner {
                flex-direction: column;
                max-height: 0;
                overflow: hidden;
            }

            /* Navbar Inner when Open */
            .navbar-inner.open {
                max-height: 1000px; /* Arbitrary large value for transition */
            }

            /* Adjust Navigation Items Layout */
            .nav-items {
                flex-direction: row;
                flex-wrap: wrap;
                gap: 8px;
                max-height: none;
            }

            /* Hide Navigation Items when Collapsed */
            .nav-items.collapsed {
                display: none;
            }

            /* Dropdown Content Position Adjustments */
            .nav-item.has-dropdown .dropdown-content {
                position: relative;
                top: 0;
                left: 0;
            }
        }

        /* Responsive Styles for Screens > 768px */
        @media (min-width: 769px) {
            /* Ensure Navigation Items take up correct width */
            .nav-item {
                flex: 1 1 calc(33.333% - 16px);
            }
        }
    </style>

    <!-- Inline JavaScript for Redirection Handling -->
    <script>
        (function() {
            // Check for redirect URL in sessionStorage
            var redirect = sessionStorage.redirect;
            delete sessionStorage.redirect;

            // If a redirect is set and different from current location, replace history
            if (redirect && redirect != location.href) {
                history.replaceState(null, null, redirect);
            }
        })();
    </script>
</head>
<body>
    <!-- Header Section -->
    <header>
        <div class="container">
            <!-- Title Bar -->
            <div class="title-bar">Redleaf OS - Tools Initialized</div>

            <!-- Navigation Bar -->
            <nav class="navbar">
                <!-- Navbar Toggle Button for Mobile -->
                <button class="navbar-toggle" aria-label="Toggle Navigation">
                    <!-- Hamburger Icon -->
                    <svg viewBox="0 0 100 80" width="24" height="24">
                        <rect width="100" height="15"></rect>
                        <rect y="30" width="100" height="15"></rect>
                        <rect y="60" width="100" height="15"></rect>
                    </svg>
                </button>

                <!-- Inner Navbar containing Navigation Items -->
                <div class="navbar-inner">
                    <div class="nav-items" id="navbar">
                        <!-- Dynamic nav items will be inserted here -->
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content Area -->
    <main>
        <div id="content-container">
            <!-- Home Content -->
            <div id="home-content"></div>

            <!-- Iframe for Loading External Content -->
            <iframe id="content-frame" sandbox="allow-scripts allow-same-origin"></iframe>
        </div>

        <!-- Loading Indicator -->
        <div id="loading">Loading...</div>
    </main>

    <!-- Footer Section -->
    <footer>
        <p>&copy; 2024 Redleaf</p>
    </footer>

    <!-- Inline JavaScript for Navigation and Content Handling -->
    <script>
        // DOM Elements
        const navbar = document.getElementById('navbar');
        const contentFrame = document.getElementById('content-frame');
        const homeContent = document.getElementById('home-content');
        const loading = document.getElementById('loading');
        const navbarToggle = document.querySelector('.navbar-toggle');

        // State Variables
        let isLoading = false;
        let availablePages = [];

        // Determine if running locally
        const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        const basePath = isLocal ? '/' : '/redleaf/';

        /**
         * Fetch available pages either from local directory or GitHub API
         * @returns {Promise<Array>} Array of page objects
         */
        async function fetchPages() {
            if (isLocal) {
                // Fetch pages from local directory
                try {
                    const response = await fetch('pages/');
                    if (!response.ok) throw new Error('Failed to fetch local pages directory');

                    const text = await response.text();
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(text, 'text/html');
                    const links = Array.from(doc.querySelectorAll('a'));
                    const pages = [];

                    for (const link of links) {
                        const href = link.getAttribute('href');

                        // Handle HTML files
                        if (href.endsWith('.html')) {
                            pages.push({
                                type: 'file',
                                name: href.replace('.html', ''),
                                path: `pages/${href}`
                            });
                            availablePages.push(`pages/${href}`);
                        }
                        // Handle directories
                        else if (href.endsWith('/')) {
                            const folderName = href.replace('/', '');
                            const folderResponse = await fetch(`pages/${href}`);
                            if (!folderResponse.ok) throw new Error(`Failed to fetch folder ${href}`);

                            const folderText = await folderResponse.text();
                            const folderDoc = parser.parseFromString(folderText, 'text/html');
                            const folderLinks = Array.from(folderDoc.querySelectorAll('a'));
                            const htmlFiles = Array.from(folderLinks)
                                .filter(a => a.getAttribute('href').endsWith('.html'))
                                .map(a => ({
                                    name: a.getAttribute('href').replace('.html', ''),
                                    path: `pages/${href}${a.getAttribute('href')}`
                                }));

                            if (htmlFiles.length > 0) {
                                pages.push({
                                    type: 'folder',
                                    name: folderName,
                                    files: htmlFiles
                                });
                                htmlFiles.forEach(file => availablePages.push(file.path));
                            }
                        }
                    }

                    return pages;
                } catch (error) {
                    console.error('Error fetching local pages:', error);
                    return [];
                }
            } else {
                // Fetch pages from GitHub repository using GitHub API
                try {
                    const response = await fetch('https://api.github.com/repos/junovhs/redleaf/contents/pages');
                    if (!response.ok) throw new Error('Failed to fetch pages list');

                    const items = await response.json();
                    const pages = [];

                    for (const item of items) {
                        // Handle HTML files
                        if (item.type === 'file' && item.name.endsWith('.html')) {
                            pages.push({
                                type: 'file',
                                name: item.name.replace('.html', ''),
                                path: `pages/${item.name}`
                            });
                            availablePages.push(`pages/${item.name}`);
                        }
                        // Handle directories
                        else if (item.type === 'dir') {
                            const folderResponse = await fetch(item.url);
                            if (!folderResponse.ok) throw new Error('Failed to fetch folder contents');

                            const folderContents = await folderResponse.json();
                            const htmlFiles = folderContents
                                .filter(file => file.name.endsWith('.html'))
                                .map(file => ({
                                    name: file.name.replace('.html', ''),
                                    path: `pages/${item.name}/${file.name}`
                                }));

                            if (htmlFiles.length > 0) {
                                pages.push({
                                    type: 'folder',
                                    name: item.name,
                                    files: htmlFiles
                                });
                                htmlFiles.forEach(file => availablePages.push(file.path));
                            }
                        }
                    }

                    return pages;
                } catch (error) {
                    console.error('Error fetching pages:', error);
                    return [];
                }
            }
        }

        /**
         * Create navigation links based on the fetched pages
         * @param {Array} pages - Array of page objects
         */
        function createNavLinks(pages) {
            // Clear existing navigation items
            navbar.innerHTML = '';

            // Create Home button
            const homeButton = document.createElement('div');
            homeButton.className = 'nav-item';
            homeButton.setAttribute('data-page', 'home');
            homeButton.textContent = 'Home';
            navbar.appendChild(homeButton);

            // Sort pages: files first, then folders, both alphabetically
            const sortedPages = [...pages].sort((a, b) => {
                if (a.type === b.type) return a.name.localeCompare(b.name);
                return a.type === 'file' ? -1 : 1;
            });

            // Create navigation items
            sortedPages.forEach(page => {
                if (page.type === 'file') {
                    // Create navigation item for file
                    const navItem = document.createElement('div');
                    navItem.className = 'nav-item';
                    navItem.setAttribute('data-page', page.path);
                    navItem.textContent = page.name;
                    navbar.appendChild(navItem);
                } else if (page.type === 'folder') {
                    // Create navigation item with dropdown for folder
                    const folderNav = document.createElement('div');
                    folderNav.className = 'nav-item has-dropdown';
                    folderNav.textContent = page.name;

                    // Create dropdown container
                    const dropdown = document.createElement('div');
                    dropdown.className = 'dropdown-content';

                    // Sort and create dropdown items
                    const sortedFiles = [...page.files].sort((a, b) => a.name.localeCompare(b.name));
                    sortedFiles.forEach(file => {
                        const dropdownItem = document.createElement('div');
                        dropdownItem.className = 'dropdown-item';
                        dropdownItem.setAttribute('data-page', file.path);
                        dropdownItem.textContent = file.name;
                        dropdown.appendChild(dropdownItem);
                    });

                    // Append dropdown to folder navigation item
                    folderNav.appendChild(dropdown);
                    navbar.appendChild(folderNav);
                }
            });

            // Add event listener for navigation clicks
            navbar.addEventListener('click', handleNavClick);

            // Check for navbar overflow to adjust font size
            checkNavOverflow();
        }

        /**
         * Adjust navigation items' font size if navbar overflows
         */
        function checkNavOverflow() {
            const navbarElement = document.querySelector('.navbar');
            const navItems = navbarElement.querySelectorAll('.nav-item');

            // Reset font size
            navItems.forEach(item => {
                item.style.fontSize = '';
            });

            // If navbar content overflows, reduce font size
            if (navbarElement.scrollWidth > navbarElement.clientWidth) {
                const currentSize = parseInt(window.getComputedStyle(navItems[0]).fontSize);
                const newSize = Math.max(currentSize * 0.9, 10); // Minimum font size of 10px

                navItems.forEach(item => {
                    item.style.fontSize = `${newSize}px`;
                });
            }
        }

        /**
         * Handle clicks on navigation items
         * @param {Event} event - Click event
         */
        function handleNavClick(event) {
            const target = event.target;

            if (target.classList.contains('nav-item')) {
                // Clicked on a main navigation item
                const pagePath = target.getAttribute('data-page');
                if (pagePath) {
                    navigateTo(pagePath);

                    // Close navbar on small screens after navigation
                    if (window.innerWidth <= 768) {
                        navbarToggle.classList.remove('active');
                        document.querySelector('.navbar-inner').classList.remove('open');
                    }
                }
            } else if (target.classList.contains('dropdown-item')) {
                // Clicked on a dropdown navigation item
                const pagePath = target.getAttribute('data-page');
                if (pagePath) {
                    navigateTo(pagePath);

                    // Close navbar on small screens after navigation
                    if (window.innerWidth <= 768) {
                        navbarToggle.classList.remove('active');
                        document.querySelector('.navbar-inner').classList.remove('open');
                    }
                }
            } else if (target.parentElement.classList.contains('has-dropdown')) {
                // Clicked on a dropdown toggle (for small screens)
                if (window.innerWidth <= 768) {
                    target.parentElement.classList.toggle('open');
                }
            }
        }

        /**
         * Navigate to a specified page
         * @param {string} pagePath - Path of the page to navigate to
         */
        function navigateTo(pagePath) {
            const isHome = pagePath === 'home';
            const url = isHome ? `${basePath}` : `${basePath}${pagePath}`;
            history.pushState({ pagePath }, '', url);
            loadContent(pagePath);
        }

        /**
         * Load content for a specified page
         * @param {string} pagePath - Path of the page to load
         */
        async function loadContent(pagePath) {
            if (isLoading) return; // Prevent multiple simultaneous loads
            isLoading = true;
            loading.style.display = 'block'; // Show loading indicator

            try {
                if (pagePath === 'home' || !availablePages.includes(pagePath)) {
                    // Load Home Content
                    contentFrame.style.display = 'none';
                    homeContent.style.display = 'block';
                    homeContent.innerHTML = `
                        <h1>Welcome to Redleaf OS</h1>
                        <p>Welcome to my hobby site! Here, you'll find a variety of tools I've developed to assist me in both my professional work and daily life. Whether you're looking for something practical or just for fun, there's something here for everyone.</p>
                        <h2>About This Site</h2>
                        <p>Redleaf OS is a collection of web-based tools and utilities designed to streamline tasks, enhance productivity, and provide entertainment. Explore the navigation menu to discover the tools available.</p>
                        <h2>Featured Tools</h2>
                        <ul>
                            <li><strong>Cash Counter:</strong> A tool to help cashiers close their drawers.</li>
                            <p></p>
                            <li><strong>Workday Timer:</strong> A timer for hourly workers who need to keep track of their day.</li>
                            <p></p>
                            <li><strong>Research Tool:</strong> Companion app for doing research with AI. I use it when writing articles. I ask AI to give me a list of questions that would inform the article I'm writing, and I gather the answers here, and export an informational doc that I give back to the AI to inform my writing.</li>
                            <p></p>
                        </ul>
                        <p>Feel free to navigate through the menu to explore and use the tools. If you encounter any issues or have suggestions, don't hesitate to reach out!</p>
                    `;

                    // Display error message if non-home page not found
                    if (pagePath !== 'home' && pagePath !== '') {
                        homeContent.innerHTML += `<p>The requested page "${pagePath}" was not found. Please check the navigation menu and try again.</p>`;
                    }
                } else {
                    // Load external page content in iframe
                    homeContent.style.display = 'none';
                    contentFrame.style.display = 'block';

                    const response = await fetch(pagePath);
                    if (!response.ok) throw new Error('Failed to fetch page content');

                    const html = await response.text();
                    contentFrame.srcdoc = html;
                }
            } catch (error) {
                // Handle errors during content loading
                console.error('Error loading content:', error);
                homeContent.style.display = 'block';
                homeContent.innerHTML = `<h1>Error</h1><p>Failed to load content. Please try again.</p>`;
            } finally {
                // Hide loading indicator and reset loading state
                loading.style.display = 'none';
                isLoading = false;
            }
        }

        /**
         * Handle browser navigation (back/forward)
         */
        function handleRoute() {
            const path = window.location.pathname.replace(basePath, '');
            const fullPath = path === '' ? 'home' : path;
            loadContent(fullPath);
        }

        // Listen for popstate events (browser navigation)
        window.addEventListener('popstate', handleRoute);

        // Toggle Navbar on Mobile
        navbarToggle.addEventListener('click', () => {
            const navbarInner = document.querySelector('.navbar-inner');
            navbarInner.classList.toggle('open');
        });

        // Close dropdowns when clicking outside the navbar
        document.addEventListener('click', function(event) {
            const isClickInsideNavbar = navbar.contains(event.target);
            if (!isClickInsideNavbar) {
                const dropdowns = document.querySelectorAll('.nav-item.has-dropdown.open');
                dropdowns.forEach(dropdown => dropdown.classList.remove('open'));
            }
        });

        /**
         * Initialize the application by fetching pages, creating navigation, and handling initial route
         */
        (async () => {
            const pages = await fetchPages();
            createNavLinks(pages);
            handleRoute();
        })();
    </script>
</body>
</html>
