<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Redleaf</title>
  
  <!-- Link to Google Fonts for 'Press Start 2P' -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&amp;display=swap" rel="stylesheet">
  
  <style>
    /* Reset and Base Styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background-color: #041317;
      font-family: 'Press Start 2P', 'Courier New', monospace;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      color: #CDCCBB;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      width: 100%;
      box-sizing: border-box;
    }

    /* Navbar Styles */
    .navbar {
      background: #B04438;
      color: #CDCCBB;
      padding: 8px;
      font-weight: bold;
      font-size: 16px;
      text-align: center;
      margin-bottom: 8px;
      border: 4px solid #CDCCBB;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      position: relative;
      width: 100%;
    }

    .navbar-toggle {
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px;
      display: none; /* Hidden by default, shown on mobile */
    }

    .navbar-toggle svg {
      fill: #CDCCBB;
      width: 24px;
      height: 24px;
    }

    /* Expand/Collapse Toggle Button */
    .nav-expand-toggle {
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px;
      margin-left: auto; /* Push to the right */
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      image-rendering: pixelated;
    }

    /* Pixel-Style Arrow using CSS */
    .nav-expand-toggle::before {
      content: "";
      display: block;
      width: 0;
      height: 0;
      border-left: 6px solid transparent;
      border-right: 6px solid transparent;
      border-top: 8px solid #CDCCBB;
      transition: transform 0.3s ease;
    }

    .nav-expand-toggle.expanded::before {
      border-top: none;
      border-bottom: 8px solid #CDCCBB;
      transform: rotate(180deg);
    }

    /* Navbar Inner (Collapsible Section) */
    .navbar-inner {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: flex-start;
      width: 100%;
      background-color: #B04438;
      transition: max-height 0.3s ease-in-out;
      overflow: hidden;
      max-height: 0; /* Collapsed by default */
    }

    .navbar-inner.expanded {
      max-height: 1000px; /* Large enough to display all items */
    }

    /* Navigation Items */
    .nav-items {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: flex-start;
      width: 100%;
    }

    .nav-item {
      color: #CDCCBB;
      text-decoration: none;
      padding: 8px 16px;
      font-size: 14px;
      background: #041317;
      border: 4px solid #CDCCBB;
      cursor: pointer;
      transition: all 0.1s;
      white-space: nowrap;
      flex: 1 1 calc(33.333% - 16px);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .nav-item.has-dropdown {
      background: #B04438; /* Make dropdown items red by default */
      position: relative;
      padding-right: 30px; /* Make room for the arrow */
    }

    /* Add dropdown arrow indicator */
    .nav-item.has-dropdown::after {
      content: ">";
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: #CDCCBB;
      font-family: 'Press Start 2P', monospace;
      font-size: 12px;
      transition: transform 0.3s ease;
    }

    /* Change arrow to V when dropdown is open */
    .nav-item.has-dropdown.open::after {
      content: "V";
      transform: translateY(-50%);
    }

    /* Adjust hover state for dropdown items */
    .nav-item.has-dropdown:hover {
      background: #B04438;
    }

    /* Make the arrow more prominent on hover */
    .nav-item.has-dropdown:hover::after {
      color: #FFFFFF;
    }

    .nav-item:hover {
      background: #B04438;
      transform: scale(1.05);
    }

    .nav-item:active {
      transform: scale(0.95);
      background: #B04438;
    }

    .nav-item.has-dropdown {
      position: relative;
      z-index: 10; /* Ensure this item and its dropdown are above others */
    }

    .dropdown-content {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      background: #041317;
      border: 4px solid #CDCCBB;
      z-index: 1000; /* Very high z-index to stay above everything else */
      min-width: 200px;
      padding: 4px;
      max-height: 400px;
      overflow-y: auto;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.8); /* Adding more shadow for better visibility */
      transition: visibility 0.3s ease-in-out, opacity 0.3s ease-in-out;
      opacity: 0; /* Initially hidden */
      visibility: hidden; /* Initially hidden */
    }

    .nav-item.has-dropdown:hover .dropdown-content,
    .nav-item.has-dropdown.open .dropdown-content {
      display: block; /* Ensure dropdown is shown when open */
      opacity: 1; /* Fully visible when active */
      visibility: visible;
      z-index: 1001; /* This ensures the dropdown content is on top when it is active */
    }

    .dropdown-item {
      color: #CDCCBB;
      padding: 8px 16px;
      text-decoration: none;
      background: #041317;
      border: none;
      cursor: pointer;
      font-size: 14px;
    }

    .dropdown-item:hover {
      background: #B04438;
    }

    /* Main Content Styles */
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: #041317;
      padding: 20px;
      border: 4px solid #CDCCBB;
      margin: 10px;
    }

    #content-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: #041317;
      border: 4px solid #CDCCBB;
      padding: 20px; /* Increased padding for better whitespace */
    }

    #content-frame {
      flex: 1;
      width: 100%;
      border: none;
      min-height: 500px;
      background: #041317;
    }

    #home-content {
      padding: 20px;
      color: #CDCCBB;
      font-family: 'Press Start 2P', monospace;
      line-height: 1.6; /* Increased line-height for better readability */
    }

    /* Footer Styles */
    footer {
      background: #041317;
      color: #CDCCBB;
      text-align: center;
      padding: 1rem;
      border-top: 4px solid #CDCCBB;
    }

    #loading {
      text-align: center;
      padding: 1rem;
      color: #CDCCBB;
    }

    /* Responsive Styles */
    @media (max-width: 768px) {
      .navbar-toggle {
        display: block;
      }

      .navbar-inner {
        flex-direction: column;
        max-height: 0;
      }

      .navbar-inner.expanded {
        max-height: 1000px;
      }

      .nav-items {
        flex-direction: column;
        width: 100%;
      }

      .nav-item {
        flex: 1 1 100%;
      }

      .nav-expand-toggle {
        position: absolute;
        top: 50%;
        right: 16px;
        transform: translateY(-50%);
      }

      .dropdown-content {
        position: relative;
        top: auto;
        left: auto;
        z-index: 1001;
      }
    }

    @media (min-width: 769px) {
      .nav-item {
        flex: 1 1 calc(33.333% - 16px);
      }

      .nav-expand-toggle {
        margin-left: 8px;
      }
    }

    /* Prevent Navigation Overflow */
    .navbar-inner {
      width: 100%;
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <nav class="navbar">
        <span>Redleaf OS - Tools Initialized</span>
        <button class="navbar-toggle" aria-label="Toggle Navigation">
          <svg viewBox="0 0 100 80" width="24" height="24">
            <rect width="100" height="15"></rect>
            <rect y="30" width="100" height="15"></rect>
            <rect y="60" width="100" height="15"></rect>
          </svg>
        </button>
        
        <!-- Expand/Collapse Toggle Button -->
        <button class="nav-expand-toggle" aria-label="Expand/Collapse Navigation">
          <!-- The arrow is created using CSS pseudo-element ::before -->
        </button>
      </nav>
      <div class="navbar-inner">
        <div class="nav-items" id="navbar" style="background-color: black; padding: 8px;">
          <!-- Dynamic nav items will be inserted here -->
        </div>
      </div>
    </div>
  </header>
  
  <main>
    <div id="content-container">
      <div id="home-content"></div>
      <iframe id="content-frame" sandbox="allow-scripts allow-same-origin" style="display:none;"></iframe>
    </div>
    <div id="loading" style="display:none;">Loading...</div>
  </main>
  
  <footer>
    <p>Â© 2024 Redleaf</p>
  </footer>
  
  <script>
    const navbar = document.getElementById('navbar');
    const contentFrame = document.getElementById('content-frame');
    const homeContent = document.getElementById('home-content');
    const loading = document.getElementById('loading');
    const navbarToggle = document.querySelector('.navbar-toggle');
    const navExpandToggle = document.querySelector('.nav-expand-toggle');
    let isLoading = false;
    let availablePages = [];
    
    const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
    const basePath = isLocal ? '/' : '/redleaf/';
    
    async function fetchPages() {
      if (isLocal) {
        try {
          const response = await fetch('pages/');
          if (!response.ok) throw new Error('Failed to fetch local pages directory');
          const text = await response.text();
          const parser = new DOMParser();
          const doc = parser.parseFromString(text, 'text/html');
          const links = Array.from(doc.querySelectorAll('a'));
          const pages = [];
          for (const link of links) {
            const href = link.getAttribute('href');
            if (href.endsWith('.html')) {
              const pageName = href.replace('.html', '');
              pages.push({type: 'file', name: pageName, path: `pages/${href}`});
              availablePages.push(`pages/${href}`);
            } else if (href.endsWith('/')) {
              const folderName = href.replace('/', '');
              const folderResponse = await fetch(`pages/${href}`);
              if (!folderResponse.ok) throw new Error(`Failed to fetch folder ${href}`);
              const folderText = await folderResponse.text();
              const folderDoc = parser.parseFromString(folderText, 'text/html');
              const folderLinks = Array.from(folderDoc.querySelectorAll('a'));
              const htmlFiles = Array.from(folderLinks)
                .filter(a => a.getAttribute('href').endsWith('.html'))
                .map(a => ({
                  name: a.getAttribute('href').replace('.html', ''),
                  path: `pages/${href}${a.getAttribute('href')}`
                }));
              if (htmlFiles.length > 0) {
                pages.push({type: 'folder', name: folderName, files: htmlFiles});
                htmlFiles.forEach(file => availablePages.push(file.path));
              }
            }
          }
          return pages;
        } catch (error) {
          console.error('Error fetching local pages:', error);
          return [];
        }
      } else {
        try {
          const response = await fetch('https://api.github.com/repos/junovhs/redleaf/contents/pages');
          if (!response.ok) throw new Error('Failed to fetch pages list');
          const items = await response.json();
          const pages = [];
          for (const item of items) {
            if (item.type === 'file' && item.name.endsWith('.html')) {
              const pageName = item.name.replace('.html', '');
              pages.push({type: 'file', name: pageName, path: `pages/${item.name}`});
              availablePages.push(`pages/${item.name}`);
            } else if (item.type === 'dir') {
              const folderResponse = await fetch(item.url);
              if (!folderResponse.ok) throw new Error('Failed to fetch folder contents');
              const folderContents = await folderResponse.json();
              const htmlFiles = folderContents
                .filter(file => file.name.endsWith('.html'))
                .map(file => ({
                  name: file.name.replace('.html', ''),
                  path: `pages/${item.name}/${file.name}`
                }));
              if (htmlFiles.length > 0) {
                pages.push({type: 'folder', name: item.name, files: htmlFiles});
                htmlFiles.forEach(file => availablePages.push(file.path));
              }
            }
          }
          return pages;
        } catch (error) {
          console.error('Error fetching pages:', error);
          return [];
        }
      }
    }
    
    function createNavLinks(pages) {
      const navbar = document.getElementById('navbar');
      navbar.innerHTML = '';

      pages.forEach(page => {
        if (page.type === 'file') {
          const navItem = document.createElement('div');
          navItem.className = 'nav-item';
          navItem.textContent = page.name;
          navItem.setAttribute('data-page', page.name); // Set to page name
          navItem.addEventListener('click', () => navigateTo(page.name));
          navbar.appendChild(navItem);
        } else if (page.type === 'folder') {
          const folderNav = document.createElement('div');
          folderNav.className = 'nav-item has-dropdown';
          folderNav.textContent = page.name;

          const dropdown = document.createElement('div');
          dropdown.className = 'dropdown-content';

          page.files.forEach(file => {
            const dropdownItem = document.createElement('div');
            dropdownItem.className = 'dropdown-item';
            dropdownItem.textContent = file.name;
            dropdownItem.setAttribute('data-page', file.name); // Set to page name
            dropdownItem.addEventListener('click', () => navigateTo(file.name));
            dropdown.appendChild(dropdownItem);
          });

          folderNav.appendChild(dropdown);

          // Add event listeners for hover to open/close the dropdown
          folderNav.addEventListener('mouseenter', () => {
            dropdown.style.display = 'block'; // Show dropdown on hover
          });
          folderNav.addEventListener('mouseleave', () => {
            dropdown.style.display = 'none'; // Hide dropdown when the mouse leaves
          });

          navbar.appendChild(folderNav);
        }
      });
    }
    
    function checkNavOverflow() {
      const navbarElement = document.querySelector('.navbar-inner');
      const navItems = navbarElement.querySelectorAll('.nav-item');
      navItems.forEach(item => {
        item.style.fontSize = '';
      });
      
      if (navbarElement.scrollWidth > navbarElement.clientWidth) {
        const currentSize = parseInt(window.getComputedStyle(navItems[0]).fontSize);
        const newSize = Math.max(currentSize * 0.9, 10);
        navItems.forEach(item => {
          item.style.fontSize = `${newSize}px`;
        });
      }
    }
    
    function navigateTo(pageName) {
      // Update the URL hash
      window.location.hash = pageName;
      // The hashchange event will handle loading the content
    }
    
    async function loadContent(pageName) {
      if (isLoading) return;
      isLoading = true;
      loading.style.display = 'block';
      try {
        if (pageName === 'home' || !availablePages.includes(`pages/${pageName}.html`)) {
          contentFrame.style.display = 'none';
          homeContent.style.display = 'block';
          homeContent.innerHTML = `
            <h1>Welcome to Redleaf OS</h1>
            <p>Welcome to my hobby site! Here, you'll find a variety of tools I've developed to assist me in both my professional work and daily life. Whether you're looking for something practical or just for fun, there's something here for everyone.</p>
            <h2>About This Site</h2>
            <p>Redleaf OS is a collection of web-based tools and utilities designed to streamline tasks, enhance productivity, and provide entertainment. Explore the navigation menu to discover the tools available.</p>
            <h2>Featured Tools</h2>
            <ul>
              <li><strong>Cash Counter:</strong> A tool to help cashiers close their drawers.</li>
              <li><strong>Workday Timer:</strong> A timer for hourly workers who need to keep track of their day.</li>
              <li><strong>Research Tool:</strong> Companion app for doing research with AI. I use it when writing articles. I ask AI to give me a list of questions that would inform the article I'm writing, and I gather the answers here, and export an informational doc that I give back to the AI to inform my writing.</li>
            </ul>
            <p>Feel free to navigate through the menu to explore and use the tools. If you encounter any issues or have suggestions, don't hesitate to reach out!</p>
          `;
          if (pageName !== 'home' && pageName !== '') {
            homeContent.innerHTML += `<p>The requested page "${pageName}" was not found. Please check the navigation menu and try again.</p>`;
          }
        } else {
          homeContent.style.display = 'none';
          contentFrame.style.display = 'block';
          const response = await fetch(`pages/${pageName}.html`);
          if (!response.ok) throw new Error('Failed to fetch page content');
          const html = await response.text();
          contentFrame.srcdoc = html;
        }
      } catch (error) {
        console.error('Error loading content:', error);
        homeContent.style.display = 'block';
        homeContent.innerHTML = `<h1>Error</h1><p>Failed to load content. Please try again.</p>`;
      } finally {
        loading.style.display = 'none';
        isLoading = false;
      }
    }
    
    function handleHashChange() {
      const hash = window.location.hash.substring(1); // Remove the '#' character
      const pageName = hash || 'home';
      loadContent(pageName);
    }
    
    // Mobile Navbar Toggle
    navbarToggle.addEventListener('click', () => {
      const navbarInner = document.querySelector('.navbar-inner');
      navbarInner.classList.toggle('open');
    });
    
    // Expand/Collapse Toggle for Lower Navigation
    navExpandToggle.addEventListener('click', () => {
      const navbarInner = document.querySelector('.navbar-inner');
      navbarInner.classList.toggle('expanded');
      navExpandToggle.classList.toggle('expanded');
    });
    
    // Close Dropdowns When Clicking Outside
    document.addEventListener('click', function(event) {
      const isClickInsideNavbar = navbar.contains(event.target) || navExpandToggle.contains(event.target);
      if (!isClickInsideNavbar) {
        const dropdowns = document.querySelectorAll('.nav-item.has-dropdown.open');
        dropdowns.forEach(dropdown => dropdown.classList.remove('open'));
      }
    });
    
    // Listen for hash changes
    window.addEventListener('hashchange', handleHashChange);
    
    // Handle initial load based on the current hash
    window.addEventListener('DOMContentLoaded', () => {
      handleHashChange();
    });
    
    // Initialize Navigation Links
    (async () => {
      const pages = await fetchPages();
      createNavLinks(pages);
    })();
  </script>

</body>
</html>
